<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart - Cool, Calm & Karter</title>
    <script src="https://js.stripe.com/v3/"></script>
  </head>

  <body>
    <h1>Your Cart</h1>

    <!-- Book selector -->
    <label for="bookSelect"><strong>Select Book:</strong></label>
    <select id="bookSelect">
      <option value="Florida, Beach & Baby">Florida, Beach & Baby</option>
      <option value="Black, Beautiful & Baby">Black, Beautiful & Baby</option>
      <option value="Adventure, Fun & Baby">Adventure, Fun & Baby</option>
      <option value="Black, Puerto Rican & Baby">Black, Puerto Rican & Baby</option>
      <option value="Go To Sleep, Karter!">Go To Sleep, Karter!</option>
    </select>

    <!-- Quantity selector -->
    <br /><br />
    <label for="quantity"><strong>Quantity:</strong></label>
    <select id="quantity">
      <option value="1" selected>1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <p id="priceDisplay"><strong>Price: $9.99</strong></p>

    <button id="checkout-button">Place Order</button>

    <script>
      const stripe = Stripe('pk_live_51ROvCtGhPxJaSGWSMQuaM8xMO7qdlR6JjDG6cG3QgYpn4u8wpN9yEANE15wIiUrNYMUml5cFfHfQxxjjx4e619Xs00BmupSz5n');

      // Book price map (all $9.99 = 999 cents)
      const books = {
        "Florida, Beach & Baby": 999,
        "Black, Beautiful & Baby": 999,
        "Adventure, Fun & Baby": 999,
        "Black, Puerto Rican & Baby": 999,
        "Go To Sleep, Karter!": 999
      };

      const updatePriceDisplay = () => {
        const book = document.getElementById('bookSelect').value;
        const quantity = parseInt(document.getElementById('quantity').value);
        const total = (books[book] * quantity) / 100;
        document.getElementById('priceDisplay').innerHTML = `<strong>Total: $${total.toFixed(2)}</strong>`;
      };

      document.getElementById('bookSelect').addEventListener('change', updatePriceDisplay);
      document.getElementById('quantity').addEventListener('change', updatePriceDisplay);

      updatePriceDisplay(); // initialize on load

      document.getElementById('checkout-button').addEventListener('click', () => {
        const selectedBook = document.getElementById('bookSelect').value;
        const quantity = parseInt(document.getElementById('quantity').value);
        const pricePerBook = books[selectedBook];
        const totalAmount = pricePerBook * quantity;

        console.log("üõí Selected Book:", selectedBook);
        console.log("üì¶ Quantity:", quantity);
        console.log("üí∞ Total amount (in cents):", totalAmount);

        fetch('https://coolcalmandkarter-site.onrender.com/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            bookTitle: selectedBook,
            amount: totalAmount
          })
        })
        .then(res => {
          console.log("üì° Raw fetch response:", res);
          if (!res.ok) {
            throw new Error(`‚ùå Server responded with status ${res.status}`);
          }
          return res.json();
        })
        .then(data => {
          console.log("‚úÖ Stripe Session ID:", data.id);
          if (data.id) {
            stripe.redirectToCheckout({ sessionId: data.id });
          } else {
            alert("‚ùå Checkout session could not be created.");
          }
        })
        .catch(err => {
          console.error('üî• Stripe Checkout Error:', err);
          alert("‚ùå There was an issue starting checkout. Check the console for details.");
        });
      });
    </script>
  </body>
</html>
